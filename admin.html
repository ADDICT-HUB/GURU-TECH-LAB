<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Guru Tech Lab â€” Admin Panel</title>
<style>
  body { font-family: Inter, sans-serif; background: #031025; color: #fff; padding: 20px; }
  .container { max-width: 800px; margin: auto; }
  .card { background: rgba(255,255,255,0.05); padding: 18px; border-radius: 12px; margin-bottom: 20px; }
  input, button { width: 100%; padding: 12px; border-radius: 10px; border: none; margin-top: 8px; font-size: 15px; }
  button { background: #ff3c00; color: #fff; font-weight: bold; cursor: pointer; }
  table { width: 100%; border-collapse: collapse; margin-top: 15px; }
  th, td { border: 1px solid #444; padding: 8px; text-align: left; font-size: 14px; }
  th { background: #1a1a2e; }
  .approve-btn { background: #00e779; color: black; }
  .reject-btn { background: red; color: #fff; }
</style>
</head>
<body>

<div class="container">

  <!-- LOGIN -->
  <div id="login-card" class="card">
    <h2>Admin Login</h2>
    <input type="password" id="admin-pass" placeholder="Enter admin password">
    <button onclick="login()">Login</button>
  </div>

  <!-- ADMIN PANEL -->
  <div id="admin-panel" style="display:none;">
    
    <div class="card">
      <h2>Current Balance</h2>
      <p><span id="current-balance">0</span> KES</p>
    </div>

    <div class="card">
      <h2>Pending Payments</h2>
      <table>
        <thead>
          <tr><th>#</th><th>Till Number</th><th>Transaction Code</th><th>Amount</th><th>Actions</th></tr>
        </thead>
        <tbody id="pending-payments"></tbody>
      </table>
    </div>

    <div class="card">
      <h2>Add Pending Payment Manually</h2>
      <input type="text" id="till-num" placeholder="Till Number">
      <input type="text" id="trx-code" placeholder="Transaction Code">
      <input type="number" id="amount" placeholder="Amount (KES)">
      <button onclick="addPending()">Add Pending Payment</button>
    </div>

    <div class="card">
      <h2>Export Approved Payments</h2>
      <button onclick="exportCSV()">Download CSV</button>
    </div>

  </div>

</div>

<script>
const ADMIN_PASS = "guruadmin";

// ===== LOGIN =====
function login(){
  const pass = document.getElementById("admin-pass").value;
  if(pass === ADMIN_PASS){
    document.getElementById("login-card").style.display = "none";
    document.getElementById("admin-panel").style.display = "block";
    loadBalance();
    loadPending();
  } else {
    alert("Incorrect password");
  }
}

// ===== STORAGE =====
function getBalance(){ return parseInt(localStorage.getItem("gtl_balance") || "0"); }
function setBalance(val){ localStorage.setItem("gtl_balance", val); }
function getPending(){ return JSON.parse(localStorage.getItem("gtl_pending") || "[]"); }
function setPending(arr){ localStorage.setItem("gtl_pending", JSON.stringify(arr)); }
function getApproved(){ return JSON.parse(localStorage.getItem("gtl_approved") || "[]"); }
function setApproved(arr){ localStorage.setItem("gtl_approved", JSON.stringify(arr)); }

// ===== LOAD BALANCE =====
function loadBalance(){
  document.getElementById("current-balance").innerText = getBalance();
}

// ===== PENDING PAYMENTS =====
function loadPending(){
  const pending = getPending();
  const tbody = document.getElementById("pending-payments");
  tbody.innerHTML = "";
  pending.forEach((p,i)=>{
    const row = document.createElement("tr");
    row.innerHTML = `
      <td>${i+1}</td>
      <td>${p.till}</td>
      <td>${p.trx}</td>
      <td>${p.amount}</td>
      <td>
        <button class="approve-btn" onclick="approve(${i})">Approve</button>
        <button class="reject-btn" onclick="reject(${i})">Reject</button>
      </td>
    `;
    tbody.appendChild(row);
  });
}

// ===== ADD PENDING =====
function addPending(){
  const till = document.getElementById("till-num").value.trim();
  const trx = document.getElementById("trx-code").value.trim();
  const amount = parseInt(document.getElementById("amount").value.trim());
  if(!till||!trx||isNaN(amount)||amount<=0){ return alert("Enter valid data"); }
  const pending = getPending();
  pending.push({till,trx,amount});
  setPending(pending);
  loadPending();
  document.getElementById("till-num").value="";
  document.getElementById("trx-code").value="";
  document.getElementById("amount").value="";
}

// ===== APPROVE =====
function approve(index){
  const pending = getPending();
  const approved = getApproved();
  const payment = pending.splice(index,1)[0];
  approved.push(payment);
  setApproved(approved);
  setPending(pending);

  // Add to balance
  const bal = getBalance();
  setBalance(bal + payment.amount);

  loadBalance();
  loadPending();
}

// ===== REJECT =====
function reject(index){
  const pending = getPending();
  pending.splice(index,1);
  setPending(pending);
  loadPending();
}

// ===== EXPORT CSV =====
function exportCSV(){
  const approved = getApproved();
  if(approved.length===0) return alert("No approved payments");
  let csv = "Till,Transaction,Amount\n";
  approved.forEach(p=>{ csv += `${p.till},${p.trx},${p.amount}\n`; });
  const blob = new Blob([csv], {type:"text/csv"});
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = "approved_payments.csv";
  a.click();
}

</script>

</body>
</html>
